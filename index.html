<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CherryDeals</title>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: linear-gradient(180deg, #7b3cff, #c40072);
      color: #fff;
      text-align: center;
    }
    header {
      padding: 20px;
      font-size: 24px;
      font-weight: bold;
    }
    .btn {
      display: block;
      margin: 10px auto;
      padding: 12px;
      width: 80%;
      border: none;
      border-radius: 6px;
      font-size: 18px;
      cursor: pointer;
      background: white;
      color: black;
    }
    .btn-pink { background: #ff4b8a; color: white; }
    .btn-green { background: #2ecc71; color: white; }
    .btn-red { background: #e74c3c; color: white; }
    .hidden { display: none; }
    .section { padding: 20px; }
    .deal {
      background: rgba(255,255,255,0.1);
      padding: 10px;
      margin: 10px 0;
      border-radius: 6px;
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
  <header>üçí CherryDeals</header>

  <div id="menu" class="section">
    <button class="btn btn-pink" onclick="showSection('createDeal')">‚úÖ –°–æ–∑–¥–∞—Ç—å —Å–¥–µ–ª–∫—É</button>
    <button class="btn" onclick="showSection('myDeals')">üìú –ú–æ–∏ —Å–¥–µ–ª–∫–∏</button>
    <button class="btn" onclick="showSection('chat')">üí¨ –ß–∞—Ç</button>
    <button class="btn" onclick="showSection('balance')">üí∞ –ë–∞–ª–∞–Ω—Å</button>
    <button class="btn" onclick="showSection('support')">üõ† –ü–æ–¥–¥–µ—Ä–∂–∫–∞</button>
    <button class="btn btn-green" onclick="window.open('https://t.me/CherrysNews','_blank')">üì∞ –ù–æ–≤–æ—Å—Ç–∏</button>
  </div>

  <!-- –°–æ–∑–¥–∞—Ç—å —Å–¥–µ–ª–∫—É -->
  <div id="createDeal" class="section hidden">
    <h2>–°–æ–∑–¥–∞—Ç—å —Å–¥–µ–ª–∫—É</h2>
    <input id="dealType" placeholder="–¢–∏–ø —Å–¥–µ–ª–∫–∏" class="btn"><br>
    <input id="dealCurrency" placeholder="–í–∞–ª—é—Ç–∞ (RUB, USD...)" class="btn"><br>
    <input id="dealAmount" placeholder="–°—É–º–º–∞" type="number" class="btn"><br>
    <input id="dealDesc" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ" class="btn"><br>
    <button class="btn btn-pink" onclick="createDeal()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å–¥–µ–ª–∫—É</button>
    <button class="btn" onclick="showSection('menu')">‚¨Ö –ù–∞–∑–∞–¥</button>
  </div>

  <!-- –ú–æ–∏ —Å–¥–µ–ª–∫–∏ -->
  <div id="myDeals" class="section hidden">
    <h2>–ú–æ–∏ —Å–¥–µ–ª–∫–∏</h2>
    <div id="dealsList"></div>
    <button class="btn" onclick="showSection('menu')">‚¨Ö –ù–∞–∑–∞–¥</button>
  </div>

  <!-- –ß–∞—Ç -->
  <div id="chat" class="section hidden">
    <h2>–ß–∞—Ç</h2>
    <div id="chatBox"></div>
    <input id="chatInput" class="btn" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É –∏–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ">
    <button class="btn btn-pink" onclick="sendMessage()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
    <button class="btn" onclick="showSection('menu')">‚¨Ö –ù–∞–∑–∞–¥</button>
  </div>

  <!-- –ë–∞–ª–∞–Ω—Å -->
  <div id="balance" class="section hidden">
    <h2>–ë–∞–ª–∞–Ω—Å</h2>
    <div id="balanceAmount">–í–∞—à –±–∞–ª–∞–Ω—Å: 0‚ÇΩ</div>
    <button class="btn" onclick="showSection('deposit')">‚ûï –ü–æ–ø–æ–ª–Ω–∏—Ç—å –±–∞–ª–∞–Ω—Å</button>
    <button class="btn" onclick="showSection('withdraw')">‚ûñ –í—ã–≤–æ–¥ —Å—Ä–µ–¥—Å—Ç–≤</button>
    <button class="btn" onclick="showSection('menu')">‚¨Ö –ù–∞–∑–∞–¥</button>
  </div>

  <div id="deposit" class="section hidden">
    <h2>–ü–æ–ø–æ–ª–Ω–∏—Ç—å –±–∞–ª–∞–Ω—Å</h2>
    <p>–†–µ–∫–≤–∏–∑–∏—Ç—ã –¥–ª—è –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è:</p>
    <p>üì± 89202555790</p>
    <p>üí≥ –Æ–º–∞–Ω–∏</p>
    <p>–ï—Å–ª–∏ –Ω—É–∂–µ–Ω –∫—Ä–∏–ø—Ç–æ-–∞–¥—Ä–µ—Å ‚Äî –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –ü–æ–¥–¥–µ—Ä–∂–∫—É.</p>
    <button class="btn" onclick="showSection('balance')">‚¨Ö –ù–∞–∑–∞–¥</button>
  </div>

  <div id="withdraw" class="section hidden">
    <h2>–í—ã–≤–æ–¥ —Å—Ä–µ–¥—Å—Ç–≤</h2>
    <input id="withdrawRekv" placeholder="–†–µ–∫–≤–∏–∑–∏—Ç—ã –¥–ª—è –æ–ø–ª–∞—Ç—ã" class="btn"><br>
    <input id="withdrawSum" type="number" placeholder="–°—É–º–º–∞ –≤—ã–≤–æ–¥–∞" class="btn"><br>
    <input id="withdrawCur" placeholder="–í–∞–ª—é—Ç–∞" class="btn"><br>
    <button class="btn btn-pink" onclick="withdraw()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É</button>
    <button class="btn" onclick="showSection('balance')">‚¨Ö –ù–∞–∑–∞–¥</button>
  </div>

  <!-- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ -->
  <div id="support" class="section hidden">
    <h2>–ü–æ–¥–¥–µ—Ä–∂–∫–∞</h2>
    <p>–û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É —á–µ—Ä–µ–∑ Telegram.</p>
    <button class="btn btn-red" onclick="showSection('menu')">‚¨Ö –ù–∞–∑–∞–¥</button>
  </div>

<script>
  const supabaseUrl = "https://jlfmvzjxjibgxstmqlme.supabase.co";
  const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpsZm12emp4amliZ3hzdG1xbG1lIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk0ODA5MzcsImV4cCI6MjA3NTA1NjkzN30.Qvv_vYHsEX-Ia5yGqiqInxdWnvrD-_cYh84fhJpMlcA";
  const client = supabase.createClient(supabaseUrl, supabaseKey);

  let currentUser = "test_user"; // –º–æ–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–≥–æ —é–∑–µ—Ä–∞ –∏–∑ auth

  function showSection(id) {
    document.querySelectorAll(".section").forEach(s => s.classList.add("hidden"));
    document.getElementById(id).classList.remove("hidden");
  }

  async function createDeal() {
    const type = document.getElementById("dealType").value;
    const currency = document.getElementById("dealCurrency").value;
    const amount = document.getElementById("dealAmount").value;
    const desc = document.getElementById("dealDesc").value;

    const { data, error } = await client.from("deals").insert([
      {
        seller: currentUser,
        type: type,
        currency: currency,
        amount: amount,
        description: desc,
        link: Math.random().toString(36).substr(2, 9),
        status: "open"
      }
    ]);
    if (error) {
      alert("–û—à–∏–±–∫–∞: " + error.message);
    } else {
      alert("–°–¥–µ–ª–∫–∞ —Å–æ–∑–¥–∞–Ω–∞!");
      showMyDeals();
      showSection("myDeals");
    }
  }

  async function showMyDeals() {
    const { data, error } = await client.from("deals").select("*").eq("seller", currentUser);
    const list = document.getElementById("dealsList");
    list.innerHTML = "";
    if (data) {
      data.forEach(d => {
        const div = document.createElement("div");
        div.className = "deal";
        div.innerHTML = `<b>${d.type}</b> ‚Äî ${d.amount} ${d.currency}<br>${d.description}<br><small>–°—Å—ã–ª–∫–∞: ${d.link}</small>`;
        list.appendChild(div);
      });
    }
  }

  async function sendMessage() {
    const input = document.getElementById("chatInput").value;
    await client.from("messages").insert([{ sender: currentUser, content: input, kind: "user" }]);
    const chatBox = document.getElementById("chatBox");
    chatBox.innerHTML += `<div><b>${currentUser}:</b> ${input}</div>`;
    document.getElementById("chatInput").value = "";
  }

  async function withdraw() {
    const sum = parseFloat(document.getElementById("withdrawSum").value);
    const { data } = await client.from("balances").select("balance").eq("user_id", currentUser).single();

    if (!data || data.balance < 6000) {
      alert("–ë–∞–ª–∞–Ω—Å –º–µ–Ω—å—à–µ 6000‚ÇΩ. –ü–æ–ø–æ–ª–Ω–∏—Ç–µ —Å—á–µ—Ç –∏–ª–∏ –ø—Ä–æ–≤–µ–¥–∏—Ç–µ –µ—â–µ —Å–¥–µ–ª–∫–∏.");
      return;
    }
    alert("–ó–∞—è–≤–∫–∞ –Ω–∞ –≤—ã–≤–æ–¥ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞!");
  }

  showSection("menu");
</script>
</body>
</html>
